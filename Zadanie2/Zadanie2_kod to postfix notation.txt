//Converts an infix expression to a postfix expression.

#include <iostream>
#include <string>
#include <math.h>

using namespace std;

template <class typ>

class Stos
{
    typ *elementy; //miejsce na znaki i elementy
    int ile; //do zapamiętania ile jest tych elementów
    
    public: Stos()
    {
        elementy = NULL;
        ile = 0;
    }
    
    Stos(int a)
    {
        elementy = new typ[ile];
        ile = a;
    }
    
    ~Stos()
    {
        delete [] elementy;
        cout << "zwalniam obiekt" << endl;
    }
    
    void put(char a) //funkcja dodajaca element i zwrocenie go ze szczytu stosu
    {
        typ *ntab = new typ[ile + 1];
        for (int i = 0; i<ile; i++)
        {
            ntab[i]=elementy[i]; //przepisanie elementow ze starej do nowej tablicy
        };
        ntab[ile] = a;//wstawimy nasz nowy element na pozycje ile
        ile = ile + 1; //zwiekszamy rozmiar bo dotychczas tylko wydluzylismy stos
        //brakuje nam jeszcze przepisania, ze stara tablica ma teraz wskazywac na nowa dluzsza tablice i stara tablice usunac
        delete [] elementy; //najpierw musimy wyczyszczic pamiec zaalokowana na elementy a potem na 
        elementy = ntab;
    }
    
    char get()//funkcja zwracajca element ze stosu
    {
        //zdejmuje ze stosu i zmniejsza rozmiar
        typ wynik = elementy[ile-1]; //ostatni znak z obecnej tablicy pobieramy i go potem zwrócimy
        typ *ntab = new typ[ile - 1]; //stworzenie tablicy o jeden mniejszej niz stos
        for (int i = 0; i<ile-1; i++) //przepisujemy elementy do elementu przedostatniego
        {
            ntab[i]=elementy[i];
        };
        
        ile=ile - 1;
        delete [] elementy;
        elementy = ntab;
        return wynik; //zwrócenie wyniku
    }
    
    char top() //funkcja zwaracająca wierzchołek stosu
    {
        return elementy[ile-1];
    }
    
    bool empty()
    {
        if (ile == 0) {return true;}
        else
        {
            return false;
        }
    }
    
    int size()
    {
        return ile;
    }
    
    void show()
    {
        cout<<"#";
        for(int i=0;i<ile;i++)
        {
            cout<<" "<< elementy[i]<<",";
        }
        cout<<endl;
    }
};

//Function to return precedence of operators
int prec(char c) {
    if(c == '^')
        return 3;
    else if(c == '/' || c=='*')
        return 2;
    else if(c == '+' || c == '-')
        return 1;
    else
        return -1;
}

int czyliczba(char a)
{
    if (a == '0'|| a == '1' || a == '2' || a == '3' || a == '4' || a == '5' || a == '6' || a == '7' || a == '8' || a == '9')
    {
        return 1;
    }
    else
    {
        return 0;
    }
}

int isbracket(char a)
{
    if (a == '(' || a == ')')
    {
        return 1;
    }
    else
    {
        return 0;
    }
}

int isoperator (char a)
{
    if(a =='+'|| a == '^'|| a == '/' || a=='*'|| a == '+' || a == '-')
    {
        return 1;
    }
    else
    {
        return 0;
    }
}

int incorrectstring(string a)
{
    int wynik = 0;
    for (int i = 0; i < a.length(); i++)
    {
        if (
            (a[i] == ' ' && a[i+1] == ' ') || (isoperator(a[i]) == 1 && isoperator(a[i+1]) == 1) || (isbracket(a[i]) == 1 && isbracket(a[i+1]) == 1)
            || (czyliczba(a[i]) == 1 && isoperator(a[i+1]) == 1) || (isoperator(a[i]) == 1 && czyliczba(a[i+1]) == 1)
            || (czyliczba(a[i]) == 1 && isbracket(a[i+1]) == 1) || (isoperator(a[i]) == 1 && isbracket(a[i+1]) == 1)
            )
        {
            wynik = 1;
        }
        else
        {
            wynik = wynik;
        }
    }
    return wynik;
}

string checknegativeatbegining(string intextin)
{
    string intext = "";
    int i = 0;
    while (i < intextin.length())
    {
        //- 2 
        if(i == 0 && intextin[0] == '-' && czyliczba(intextin[2]) == 1 && czyliczba(intextin[3]) == 0)
        {
            intext = intext + '(' + ' '+ '0' + ' ' + intextin[0] + ' ' + intextin[2] + ' ' + ')';
            i = 3;
        }
        //- 22 
        else if(i == 0 && intextin[0] == '-' && czyliczba(intextin[2]) == 1 && czyliczba(intextin[3]) == 1 && czyliczba(intextin[4]) == 0)
        {
            intext = intext + '(' + ' ' + '0'+ ' ' + intextin[0] + ' ' + intextin[2] + intextin[3] + ' ' + ')';
            i = 4;
        }
        //- 222
        else if(i == 0 && intextin[0] == '-' && czyliczba(intextin[2]) == 1 && czyliczba(intextin[3]) == 1 && czyliczba(intextin[4]) == 1 && czyliczba(intextin[5]) == 0)
        {
            intext = intext + '(' + ' ' + '0' + ' ' + intextin[0] + ' ' + intextin[2] + intextin[3] + intextin[4] + ' ' + ')';
            i = 5;
        }
        //- 2222
        else if(i == 0 && intextin[0] == '-' && czyliczba(intextin[2]) == 1 && czyliczba(intextin[3]) == 1 && czyliczba(intextin[4]) == 1 && czyliczba(intextin[5]) == 1 && czyliczba(intextin[6]) == 0)
        {
            intext = intext + '(' + ' ' + '0' + ' ' + intextin[0] + ' ' + intextin[2] + intextin[3] + intextin[4] + intextin[5] + ' ' + ')';
            i = 6;
        }
        //- 22222
        else if(i == 0 && intextin[0] == '-' && czyliczba(intextin[2]) == 1 && czyliczba(intextin[3]) == 1 && czyliczba(intextin[4]) == 1 && czyliczba(intextin[5]) == 1 && czyliczba(intextin[6]) == 1 && czyliczba(intextin[7]) == 0)
        {
            intext = intext + '(' + ' ' + '0' + ' ' + intextin[0] + ' ' + intextin[2] + intextin[3] + intextin[4] + intextin[5] + intextin[6] + ' ' + ')';
            i = 7;
        }
        else
        {
            intext = intext + intextin[i];
            i = i + 1;
        }
    }
    
    return intext;
}

string checknegativeinsideofstring(string a)
{
    string outstring = "";
    int i = 0;
    while (i < a.length())
    {
        //negative number after left bracket (so something like ( - 3 ))
        if (a[i] == '(' && a[i+2] == '-' && czyliczba(a[i+4]) == 1 && a[i + 5] == ' ')
        {
            outstring = outstring + a[i] + ' ' + '(' + ' ' + '0' + ' ' + a[i+2] + a[i+3] + a[i+4] + a[i+5] + ')';
            i = i + 5;
        }
        //( - 33 )
        else if (a[i] == '(' && a[i+2] == '-' && czyliczba(a[i+4]) == 1 && czyliczba(a[i+5]) == 1 && a[i + 6] == ' ')
        {
            outstring = outstring + a[i] + ' ' + '(' + ' ' + '0' + ' ' + a[i+2] + a[i+3] + a[i+4] + a[i+5] + a[i+6] + ')';
            i = i + 6;
        }
        //( - 333 )
        else if (a[i] == '(' && a[i+2] == '-' && czyliczba(a[i+4]) == 1 && czyliczba(a[i+5]) == 1 && czyliczba(a[i + 6]) == 1 && a[i + 7] == ' ')
        {
            outstring = outstring + a[i] + ' ' + '(' + ' ' + '0' + ' ' + a[i+2] + a[i+3] + a[i+4] + a[i+5] + a[i+6] + a[i+7] + ')';
            i = i + 7;
        }
        //negative number after operator so something like * - 3
        else if (isoperator(a[i]) == 1 && a[i+2] == '-' && czyliczba(a[i+4]) == 1 && a[i+5] == ' ')
        {
            outstring = outstring + a[i] + ' ' + '(' + ' ' + '0' + ' ' + a[i+2] + a[i+3] + a[i+4] + a[i+5] + ')';
            i = i + 5;
        }
        else if (isoperator(a[i]) == 1 && a[i+2] == '-' && czyliczba(a[i+4]) == 1 && (i+5 == a.length()))
        {
            outstring = outstring + a[i] + ' ' + '(' + ' ' + '0' + ' ' + a[i+2] + a[i+3] + a[i+4] + ' ' + ')';
            i = i + 5;
        }
        else if (isoperator(a[i]) == 1 && a[i+2] == '-' && czyliczba(a[i+4]) == 1 && czyliczba(a[i+5]) == 1 and a[i+6] == ' ')
        {
            outstring = outstring + a[i] + ' ' + '(' + ' ' + '0' + ' ' + a[i+2] + a[i+3] + a[i+4] + a[i+5] + a[i+6] + ')';
            i = i + 6;
        }
        else if (isoperator(a[i]) == 1 && a[i+2] == '-' && czyliczba(a[i+4]) == 1 && czyliczba(a[i+5]) == 1 && i+6 == a.length())
        {
            outstring = outstring + a[i] + ' ' + '(' + ' ' + '0' + ' ' + a[i+2] + a[i+3] + a[i+4] + a[i+5] + ' ' + ')';
            i = i + 6;
        }
        else if (isoperator(a[i]) == 1 && a[i+2] == '-' && czyliczba(a[i+4]) == 1 && czyliczba(a[i+5]) == 1 && czyliczba(a[i+6]) == 1 and a[i+7] == ' ')
        {
            outstring = outstring + a[i] + ' ' + '(' + ' ' + '0' + ' ' + a[i+2] + a[i+3] + a[i+4] + a[i+5] + a[i+6] + a[i+7] + ')';
            i = i + 7;
        }
        else if (isoperator(a[i]) == 1 && a[i+2] == '-' && czyliczba(a[i+4]) == 1 && czyliczba(a[i+5]) == 1 && czyliczba(a[i+6]) == 1 && i+7 == a.length())
        {
            outstring = outstring + a[i] + ' ' + '(' + ' ' + '0' + ' ' + a[i+2] + a[i+3] + a[i+4] + a[i+5] + a[i+6] + ' ' + ')';
            i = i + 7;
        }
        else 
        {
            outstring = outstring + a[i];
            i = i + 1;
        }
    }
    
    return outstring;
}

string infixToPostfix(string intextin)
{
    Stos<char> *wskStos = new Stos<char>(0);
    string outtext = "";
    string intext = checknegativeinsideofstring(checknegativeatbegining(intextin));
    
    for (int i = 0; i < intext.length(); i++)
    {
        char c = intext[i];
        if (c != ' ')
        {
            if(czyliczba(c) == 1 && czyliczba(intext[i+1]) == 0)
            {
                outtext = outtext + c;
            }
            if (czyliczba(c) == 1 && czyliczba(intext[i+1]) == 1 && czyliczba(intext[i+2]) == 0)
            {
                outtext = outtext + c + intext[i+1];
                i = i + 2;
            }
            if (czyliczba(c) == 1 && czyliczba(intext[i+1]) == 1 && czyliczba(intext[i+2]) == 1)
            {
                outtext = outtext + c + intext[i+1] + intext[i+2];
                i = i + 3;
            }
            if(c == '(')
            {
                wskStos -> put(c);
            }
            if(c == ')') 
            {
			    while(wskStos -> top() != '(')
			    {
			    	outtext += wskStos -> top();
		    		wskStos -> get();
		    	}
		    	wskStos -> get();
	    	}
	    	if (isoperator(c) == 1) 
	    	{
			    while(!wskStos -> empty() && prec(intext[i]) <= prec(wskStos -> top())) 
			    {
			    	outtext += wskStos -> top();
			    	wskStos -> get();
			    }
			    wskStos -> put(c);
		    }
        }
        if (c == ' ')
        {
            outtext =outtext + ' ';
        }
    }
    
    // Pop all the remaining elements from the stack
	while(!wskStos -> empty()) {
		outtext += wskStos -> top();
		wskStos -> get();
	}
    
    string outtext2 = "";
    int i = 0;
    
    while (i < outtext.length())
    {
        if (czyliczba(outtext[i]) == 1 && isoperator(outtext[i+1]) == 1)
        {
            outtext2 = outtext2 + outtext[i] + ' ';
            i = i + 1;
        }
        else if (isoperator(outtext[i]) == 1 && isoperator(outtext[i+1]) == 1)
        {
            outtext2 = outtext2 + outtext[i] + ' ';
            i = i + 1;
        }
        else if (outtext[i] == ' ' && outtext[i+1] == ' ' && outtext[i+2] == ' ' && outtext[i+3] != ' ')
        {
            outtext2 = outtext2 + outtext[i];
            i = i + 3;
        }
        else if (outtext[i] == ' ' && outtext[i+1] == ' ' && outtext[i+2] == ' ' && outtext[i+3] == ' ')
        {
            outtext2 = outtext2 + outtext[i];
            i = i + 4;
        }
        else if (outtext[i] == ' ' && outtext[i+1] == ' ' && outtext[i+2] != ' ')
        {
            outtext2 = outtext2 + outtext[i];
            i = i + 2;
        }
        else if(i == 0 && outtext[i] == ' ')
        {
            outtext2 == outtext2;
            i = i + 1;
        }
        else
        {
            outtext2 = outtext2 + outtext[i];
            i = i + 1;
        }
    }
    
    cout << "outtext:"<< outtext << endl;
    cout << "outtext2:"<< outtext2 << endl;
    return outtext;
}

int main() {
    
    string input = "- 2 ^ 2 * 2 - 3 * 4 + 2 - 3 ^ ( - 3 )";
    if(incorrectstring(input) == 0)
    {
        string exp2 = infixToPostfix(input);
    }
    else
    {
        cout << "Incorrect string. Please ensure that each symbol or number are separated with space." << endl;
    }
}
